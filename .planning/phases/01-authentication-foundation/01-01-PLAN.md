---
phase: 01-authentication-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [requirements.txt, auth/config.yaml, auth/authenticator.py, .gitignore]
autonomous: true
---

<objective>
Set up authentication infrastructure with streamlit-authenticator library, Argon2id password hashing, and secure configuration.

Purpose: Establish secure authentication foundation before integrating into web UI. Ensures credentials are properly hashed and cookie signing key is cryptographically secure.

Output: Authentication module ready for integration, dependencies installed, configuration files created with secure defaults.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/1-authentication-foundation/1-RESEARCH.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md
@requirements.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install authentication dependencies</name>
  <files>requirements.txt</files>
  <action>
    Add these dependencies to requirements.txt (maintaining alphabetical order within sections):
    - streamlit-authenticator>=0.3.3 (complete authentication module with cookie/session management)
    - argon2-cffi>=23.1.0 (Argon2id password hashing - 2026 standard, GPU-resistant)
    - PyYAML>=6.0.1 (YAML configuration management)

    Run `pip install streamlit-authenticator argon2-cffi PyYAML` to install.

    Why not bcrypt: Research shows Argon2id is the 2026 standard (winner of Password Hashing Competition 2015), GPU-resistant, and recommended over bcrypt for new projects.
  </action>
  <verify>pip list | grep -E "streamlit-authenticator|argon2-cffi|PyYAML" shows all three packages installed</verify>
  <done>Dependencies installed and requirements.txt updated with specific versions</done>
</task>

<task type="auto">
  <name>Task 2: Create authentication module structure</name>
  <files>auth/config.yaml, auth/authenticator.py, .gitignore</files>
  <action>
    1. Create `auth/` directory at project root

    2. Create `auth/config.yaml` with this structure (from research):
    ```yaml
    credentials:
      usernames:
        admin:
          email: admin@example.com
          failed_login_attempts: 0
          first_name: Admin
          last_name: User
          logged_in: False
          password: change_me_on_first_login
    cookie:
      expiry_days: 30
      key: PLACEHOLDER_WILL_BE_REPLACED
      name: rag_auth_cookie
    ```

    3. Create `auth/authenticator.py` with initialization function:
    ```python
    """Authentication module initialization for Streamlit app."""
    import yaml
    from yaml.loader import SafeLoader
    from streamlit_authenticator import Authenticate
    from typing import Tuple

    def load_authenticator() -> Authenticate:
        """Load and initialize Streamlit authenticator from config.

        Returns:
            Authenticate: Configured authenticator instance
        """
        with open('auth/config.yaml') as file:
            config = yaml.load(file, Loader=SafeLoader)

        return Authenticate(
            config['credentials'],
            config['cookie']['name'],
            config['cookie']['key'],
            config['cookie']['expiry_days']
        )
    ```

    4. Update `.gitignore` to exclude `auth/config.yaml` (contains sensitive credentials):
    Add line: `auth/config.yaml`

    Why YAML not database: Research shows YAML is appropriate for single-user systems, streamlit-authenticator supports it with automatic password hashing.
  </action>
  <verify>
    - Directory `auth/` exists
    - File `auth/config.yaml` exists with proper YAML structure
    - File `auth/authenticator.py` exists and imports succeed
    - `.gitignore` contains `auth/config.yaml`
  </verify>
  <done>Authentication module structure created with configuration and initialization code</done>
</task>

<task type="auto">
  <name>Task 3: Generate secure cookie key and update config</name>
  <files>auth/config.yaml</files>
  <action>
    Generate cryptographically secure cookie signing key using Python secrets module:

    Run this command to generate key:
    ```bash
    python -c "import secrets; print(secrets.token_urlsafe(32))"
    ```

    Update `auth/config.yaml` cookie.key field with generated key (replace PLACEHOLDER_WILL_BE_REPLACED).

    Important: This key must remain secret and is used to sign authentication cookies. If compromised, sessions can be forged.

    Why token_urlsafe(32): Generates 32-byte random key (256 bits) that's URL-safe and cryptographically secure. Standard for cookie signing (from research Pattern 3).
  </action>
  <verify>
    - `auth/config.yaml` cookie.key field is not PLACEHOLDER_WILL_BE_REPLACED
    - Cookie key is at least 32 characters
    - grep "PLACEHOLDER" auth/config.yaml returns nothing
  </verify>
  <done>Secure cookie signing key generated and configured in auth/config.yaml</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pip list` shows streamlit-authenticator, argon2-cffi, PyYAML installed
- [ ] `auth/` directory exists with config.yaml and authenticator.py
- [ ] `auth/config.yaml` has secure cookie key (not placeholder)
- [ ] `.gitignore` contains auth/config.yaml
- [ ] Python can import: `python -c "from auth.authenticator import load_authenticator; print('OK')"`
</verification>

<success_criteria>
- All dependencies installed and requirements.txt updated
- Authentication module structure complete (auth/ directory with config.yaml and authenticator.py)
- Secure cookie key generated and configured
- Configuration file protected in .gitignore
- No errors when importing authentication module
</success_criteria>

<output>
After completion, create `.planning/phases/01-authentication-foundation/01-01-SUMMARY.md`
</output>
